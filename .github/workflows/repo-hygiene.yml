name: repo-hygiene
on: [pull_request]
jobs:
  forbid-venv:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Fail if virtualenv artifacts are tracked
        run: |
          set -euo pipefail
          bad=$(git ls-files | grep -E '(^\\.venv|/\\.venv|^venv|/site-packages/|\\.dist-info/)' || true)
          if [ -n "$bad" ]; then
            echo "Tracked virtualenv artifacts detected:" >&2
            echo "$bad" >&2
            exit 1
          fi

  forbid-hidden-unicode:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Fail if hidden/bidirectional Unicode chars exist
        run: |
          set -euo pipefail
          # Zero-width characters: BOM, ZWJ, ZWNJ, LRM, RLM
          # Bidirectional controls: LRO, RLO, LRE, RLE, PDF, LRI, RLI, FSI, PDI
          # Hidden characters: LRM, RLM, ZWJ, ZWNJ
          ! grep -RInP '[\\x{200B}-\\x{200D}\\x{FEFF}\\x{202A}-\\x{202E}\\x{2066}-\\x{2069}\\x{200E}\\x{200F}]' . || (echo "Hidden/bidirectional Unicode detected" && exit 1)
